<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalogue - Loedi Kids</title>
  <!-- Bootstrap 5 CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom CSS pour gradients et styles Tailwind-like -->
   <link href="css/custom.css" rel="stylesheet">

  
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold gradient-text" href="index.html">Loedi Kids</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link active" href="catalogue.html">Catalogue</a></li>
          <li class="nav-item"><a class="nav-link" href="panier.html">Panier</a></li>
          <li class="nav-item"><a class="nav-link" href="profil.html">Profil</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          <li class="nav-item nav-admin" style="display: none;"><a class="nav-link" href="admin.html">Admin</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="text-center mb-5">
      <h1 class="display-3 fw-bold gradient-text mb-3">üõçÔ∏è Notre Collection</h1>
      <p class="lead text-muted">
        D√©couvrez nos produits de qualit√© pour votre b√©b√©
      </p>
    </div>

    <div class="row g-4">
      <!-- Sidebar Filtres -->
      <div class="col-12 col-lg-3">
        <div class="card card-gradient shadow-lg p-4 border border-pink sticky-top" style="top: 1rem;">
          <div class="d-flex align-items-center justify-content-between mb-4">
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-funnel text-pink fs-3"></i>
              <h2 class="h4 fw-bold text-dark">Filtres</h2>
            </div>
            <button onclick="resetFilters()" class="btn btn-outline-secondary btn-sm rounded-pill">Effacer</button>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small mb-2">üë∂ √Çge du b√©b√©</label>
            <div class="d-grid gap-2">
              <button data-filter="age" data-value="Tous" class="btn btn-filter btn-filter-active rounded-3 py-2">Tous</button>
              <button data-filter="age" data-value="0-3 mois" class="btn btn-filter rounded-3 py-2">0-3 mois</button>
              <button data-filter="age" data-value="3-6 mois" class="btn btn-filter rounded-3 py-2">3-6 mois</button>
              <button data-filter="age" data-value="6-12 mois" class="btn btn-filter rounded-3 py-2">6-12 mois</button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small mb-2">üè∑Ô∏è Type de produit</label>
            <div class="d-grid gap-2">
              <button data-filter="type" data-value="Tous" class="btn btn-filter btn-filter-active rounded-3 py-2">Tous</button>
              <button data-filter="type" data-value="Body" class="btn btn-filter rounded-3 py-2">Body</button>
              <button data-filter="type" data-value="Pyjama" class="btn btn-filter rounded-3 py-2">Pyjama</button>
              <button data-filter="type" data-value="Ensemble" class="btn btn-filter rounded-3 py-2">Ensemble</button>
              <button data-filter="type" data-value="Accessoire" class="btn btn-filter rounded-3 py-2">Accessoire</button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small mb-2">üí∞ Prix maximum</label>
            <input type="number" id="prixMax" placeholder="Ex: 20000 FCFA" value="" class="form-control border-2 border-blue rounded-3 p-3 bg-blue-50 focus:bg-white focus:border-blue">
          </div>

          <!-- Stats -->
          <div class="stats-banner rounded-3 p-3 mt-4 text-center">
            <p class="small mb-0 text-muted">
              <span class="fw-bold text-pink fs-5" id="produits-count">0</span> produits trouv√©s
            </p>
          </div>
        </div>
      </div>

      <!-- Grille de produits -->
      <div class="col-12 col-lg-9">
        <div id="produits-grid" class="row g-4">
          <!-- Loading State -->
          <div id="loading-products" class="loading-spinner show col-12">
            <div class="spinner-border text-pink" role="status" style="width: 3rem; height: 3rem;">
              <span class="visually-hidden">Chargement des produits...</span>
            </div>
            <p class="text-muted mt-3">D√©couverte de notre collection...</p>
          </div>

          <!-- Error State -->
          <div id="error-products" class="alert alert-warning text-center py-5 col-12" style="display: none;">
            <i class="bi bi-exclamation-triangle fs-1 mb-3 text-warning"></i>
            <h4>Erreur chargement produits</h4>
            <p class="mb-3">Impossible de charger la collection. V√©rifiez votre connexion.</p>
            <button onclick="loadProduits()" class="btn btn-gradient">R√©essayer</button>
          </div>
        </div>

        <!-- Pagination -->
        <div id="pagination-container" class="pagination-custom" style="display: none;">
          <button class="page-btn" onclick="changePage(-1)" id="prev-page">Pr√©c√©dent</button>
          <span id="page-info"></span>
          <button class="page-btn" onclick="changePage(1)" id="next-page">Suivant</button>
        </div>
      </div>
    </div>

    <!-- Section info -->
    <div class="info-section mt-5">
      <div class="row g-4">
        <div class="col-12 col-md-4 text-center">
          <div class="info-card">
            <div class="display-4 mb-2">üéÅ</div>
            <h4 class="fw-bold text-dark mb-1">Livraison Offerte</h4>
            <p class="text-muted small">D√®s 2 articles √† Douala</p>
          </div>
        </div>
        <div class="col-12 col-md-4 text-center">
          <div class="info-card" style="background: linear-gradient(to bottom right, #f3e8ff, #e9d5ff); border-color: #e9d5ff;">
            <div class="display-4 mb-2">üíù</div>
            <h4 class="fw-bold text-dark mb-1">Satisfait ou Rembours√©</h4>
            <p class="text-muted small">Retour sous 7 jours</p>
          </div>
        </div>
        <div class="col-12 col-md-4 text-center">
          <div class="info-card" style="background: linear-gradient(to bottom right, #dbeafe, #bfdbfe); border-color: #bfdbfe;">
            <div class="display-4 mb-2">üìû</div>
            <h4 class="fw-bold text-dark mb-1">Service Client</h4>
            <p class="text-muted small">Disponible 7j/7</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Script dynamique -->
   
  <script type="module">
    import { checkAuth, loadProduits, toggleLike } from './js/api.js';

    const API_BASE = 'http://localhost:3000/api';

    let allProduits = [];
    let currentProduits = [];
    let filters = { age: 'Tous', type: 'Tous', prixMax: '' };
    let currentPage = 1;
    const itemsPerPage = 6;

    window.resetFilters = resetFilters;
    window.changePage = changePage;
    window.toggleLikeBtn = toggleLikeBtn;

    // Update navbar
    async function updateNavbar() {
      const auth = await checkAuth();
      const adminLink = document.querySelector('.nav-admin');
      if (adminLink) adminLink.style.display = auth.isAdmin ? 'block' : 'none';
    }

 async function loadAllProduits() {
  try {
    console.log('üîç Chargement depuis:', `${API_BASE}/produits`);
    
    const response = await fetch(`${API_BASE}/produits`);
    console.log('üì° Statut r√©ponse:', response.status);
    
    if (!response.ok) throw new Error('Erreur chargement produits');
    
    const data = await response.json();
    console.log('üì¶ Donn√©es re√ßues:', data);
    
    // ‚úÖ G√©rer diff√©rents formats de r√©ponse
    allProduits = Array.isArray(data) ? data : (data.produits || []);
    console.log('‚úÖ Produits charg√©s:', allProduits.length, allProduits);
    
    // ‚úÖ Cacher le loader
    const loadingEl = document.getElementById('loading-products');
    if (loadingEl) {
      loadingEl.style.display = 'none';
    }
    
    applyFilters();
    updatePagination();
  } catch (err) {
    console.error('‚ùå Erreur compl√®te:', err);
    
    const loadingEl = document.getElementById('loading-products');
    const errorEl = document.getElementById('error-products');
    
    if (loadingEl) loadingEl.style.display = 'none';
    if (errorEl) errorEl.style.display = 'block';
  }
}
    // Apply filters client-side (since static data)
    function applyFilters() {
      let filtered = allProduits.filter(p => 
        (filters.age === 'Tous' || p.age === filters.age) &&
        (filters.type === 'Tous' || p.type === filters.type) &&
        (!filters.prixMax || p.prix <= parseInt(filters.prixMax))
      );
      const start = (currentPage - 1) * itemsPerPage;
      currentProduits = filtered.slice(start, start + itemsPerPage);
      document.getElementById('produits-count').textContent = filtered.length;
      renderProduits();
    }

    // Render produits
    function renderProduits() {
      const grid = document.getElementById('produits-grid');
      if (currentProduits.length === 0) {
        grid.innerHTML = `
          <div class="col-12">
            <div class="empty-state">
              <i class="bi bi-box-seam fs-1 text-muted mb-3"></i>
              <h5 class="text-muted">Aucun produit trouv√©</h5>
              <p class="text-muted">Essayez d'ajuster vos filtres.</p>
              <button onclick="resetFilters()" class="btn btn-gradient">Effacer Filtres</button>
            </div>
          </div>
        `;
        document.getElementById('pagination-container').style.display = 'none';
        return;
      }
      grid.innerHTML = currentProduits.map(produit => `
        <div class="col-12 col-md-6 col-xl-4">
          <div class="card card-product h-100 rounded-3 overflow-hidden">
            <div class="position-relative overflow-hidden" style="height: 16rem;">
              <img 
                src="${produit.image_url || 'https://via.placeholder.com/400x300?text=Produit'}" 
                alt="${produit.nom}"
                class="w-100 h-100 object-fit-cover image-hover"
              />
              <button class="heart-btn" onclick="toggleLikeBtn(${produit.id}, this)">
                <i class="bi bi-heart text-pink"></i>
              </button>
              <div class="age-badge">${produit.age}</div>
              <div class="type-badge">${produit.type}</div>
            </div>
            <div class="card-body p-4">
              <h3 class="h5 fw-bold text-dark mb-2">${produit.nom}</h3>
              <p class="text-muted small line-clamp-2 mb-3">${produit.description}</p>
              <div class="d-flex align-items-center justify-content-between">
                <span class="fs-4 fw-bold price-gradient">${produit.prix.toLocaleString()} FCFA</span>
                <a href="produit-detail.html?id=${produit.id}" class="btn btn-gradient px-4 py-2 rounded-pill fw-semibold small d-flex align-items-center gap-1">
                  <i class="bi bi-bag"></i>
                  Voir
                </a>
              </div>
            </div>
          </div>
        </div>
      `).join('');
      document.getElementById('pagination-container').style.display = allProduits.length > itemsPerPage ? 'flex' : 'none';
    }

    // Update pagination
    function updatePagination() {
      const totalPages = Math.ceil(allProduits.length / itemsPerPage);
      document.getElementById('page-info').textContent = `Page ${currentPage} sur ${totalPages}`;
      document.getElementById('prev-page').disabled = currentPage <= 1;
      document.getElementById('next-page').disabled = currentPage >= totalPages;
    }

    // Change page
    function changePage(direction) {
      currentPage += direction;
      applyFilters();
    }

    // Filter functions
    function setFilter(key, value) {
      filters[key] = value === 'Tous' ? '' : value;
      if (key === 'prixMax') filters[key] = value ? parseInt(value) : '';
      currentPage = 1;
      applyFilters();
      updateFilterButtons(key, value);
    }

    function resetFilters() {
      filters = { age: 'Tous', type: 'Tous', prixMax: '' };
      currentPage = 1;
      document.getElementById('prixMax').value = '';
      applyFilters();
      updateFilterButtons();
    }

    function updateFilterButtons(filterKey = null, value = null) {
      document.querySelectorAll('[data-filter="age"]').forEach(btn => {
        btn.classList.toggle('btn-filter-active', btn.dataset.value === filters.age || filters.age === '');
      });
      document.querySelectorAll('[data-filter="type"]').forEach(btn => {
        btn.classList.toggle('btn-filter-active', btn.dataset.value === filters.type || filters.type === '');
      });
      if (filterKey === 'prixMax') document.getElementById('prixMax').value = value || '';
    }

    // Toggle like
    async function toggleLikeBtn(id, btn) {
      try {
        await toggleLike(id);
        const icon = btn.querySelector('i');
        icon.classList.toggle('bi-heart');
        icon.classList.toggle('bi-heart-fill');
        icon.style.color = icon.classList.contains('bi-heart-fill') ? '#dc2626' : '#ec4899';
      } catch (err) {
        alert('Erreur like: ' + err.message);
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('[data-filter]').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.filter;
          const value = btn.dataset.value;
          setFilter(key, value);
        });
      });
      document.getElementById('prixMax').addEventListener('input', (e) => setFilter('prixMax', e.target.value));
    });

    // Init
    document.addEventListener('DOMContentLoaded', async () => {
      await updateNavbar();
      await loadAllProduits();
    });
  </script>
</body>
</html>